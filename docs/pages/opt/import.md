# 数据导入

本系统提供了一个标准的数据导入方法，通常需要导入的数据源格式都不一样，在系统中为各种格式设计数据解析导入并不是一个好办法。

而通过提供一种中间格式的转换则能很好的解决这个问题，系统提供了一个 excel 模板，首先将其他数据源在系统外进行整理，做成符合格式模板的数据，再进行导入。

## 导入数据模板

在系统管理-系统设置界面可以下载模板

![](http://static.toughcloud.net/toughsms/tc_20180518143910_4.png)


模板是一个典型的 excel 文档, 在模板中定义了多个子页面，每个子页面定义了一组数据


#### 组织结构

组织结构是组织节点和区域的组合数据

- 顶层组织没有父级ID，设置为NA
- 组织没有区域ID，设置为NA
- 区域没有组织代码，联系人，联系手机，营业地址，营业时间，设置为NA

![](http://static.toughcloud.net/toughsms/tc_20180518144102_5.png)

#### 操作员

操作员数据模板包含了操作员组和操作员

- 操作员组没有组织ID，操作员ID，操作员姓名，手机，email，密码，设置为NA

![](http://static.toughcloud.net/toughsms/tc_20180518151832_8.png)

#### 终端数据

![](http://static.toughcloud.net/toughsms/tc_20180518151946_9.png)

#### 收费项目

![](http://static.toughcloud.net/toughsms/tc_20180518152023_10.png)

#### 服务商品

服务商品包含了服务和商品数据的组合

注意模板中标记为NA的

![](http://static.toughcloud.net/toughsms/tc_20180518152121_11.png)

#### 用户数据

![](http://static.toughcloud.net/toughsms/tc_20180518152308_12.png)


> 注意所有数据的ID均为自己生成，可以利用Excel本身的功能来批量生成，注意ID的依赖关系

> 大部分情况下，可以手工完成数据的整理，有些复杂的情况，可以借助VBA脚本或其他脚本来实现。


## 导入数据

如果数据量不大的话，可以一次性导入，在系统管理-系统设置界面，通过“导入初始化数据”功能来实现。

在组织节点管理界面，操作员管理界面，终端管理界面，商品管理界面，客户受理界面都可以单独的导入数据。

> 注意，EXCEL 文档的子页面名称是固定的不可更改，更改后就不会导入数据了。

如果重复多次导入数据，如果系统中已经修改数据，导入时会覆盖相同ID的数据。


## 导入硬派计费 V4.x 数据

#### 转换导出原系统数据

系统提供了一个快捷的数据转换功能，进入系统管理-数据转换界面，填写数据库连接信息。

> 注意：转换数据过程并不会修改元数据，不过还是建议首先对原数据库做完整备份，或者创建一个独立的数据库，导入元数据库数据，对于不在同一服务器的数据库，强烈建议这么做，保证安全也保证速度。

![](http://static.toughcloud.net/toughsms/tc_20180601091939_1.png)

属性介绍

- 组织名称：原有数据将导入到新系统的一个组织中，你需要对这个组织命名，通常使用你的运营公司名称，原有的区域将全部归属于这个组织。
- 密码加密密钥：原系统的用户密码采用了AES加密，数据导入会使用密钥进行解密，该密钥为 原系统配置文件 /opt/toughee/etc/toughee.json 中 system - secret 的值。


点击数据转换，将会导出一个和本系统数据模板格式一致的 excel 文件。

#### 数据调整

由于数据结构的差异比较大，建议对导出的模板数据做核对整理的工作，在导入之前，你还可以对数据进行修改。

- 组织结构调整

可以根据模板规则对组织结构数据进行调整，修改，但不要修改组织ID，区域ID，因为这些ID都被其他数据关联。

- 操作员数据调整

由于原系统对操作密码的不可逆加密，操作员的密码都被重置为123456，需要修改，可以导入后修改，也可以直接修改excel文件。

导入的操作员权限组还需要在导入后在系统中进行授权调整，请参考操作员授权文档。

- 服务商品调整

原系统所有商品被关联到一个服务，如果还需要在原有的商品上开展业务，必须为商品重新创建对应的服务，这个调整工作可以直接在excel数据文件中修改，也可以在导入数据之后进行调整。

商品资费归属的服务的策略比如在线并发数，速率等这些需要在导入数据后在系统中进行调整。

通常商品资费的数量决定这个调整的工作量。

- 用户数据调整

检查是否有用户的过期时间格式不对等错误，一般来说很少，在数据导入时，如果个别用户数据格式有问题，会终止导入，此时需要检查系统日志，系统会记录错误的原因，对错误数据进行修改，或者先剪切出来后面单独处理。

- 用户交易数据

数据转换也会导出原系统的交易数据，这部分数据导入是可选的，默认不导入，你可以在交易管理界面单独导入。
