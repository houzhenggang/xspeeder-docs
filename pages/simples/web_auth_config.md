### 7.1 神行者路由-WEB认证配置
***

#### WEB认证介绍

神行者路由WEB认证支持账户密码认证、密码认证、微信认证（暂时不支持强制关注），

神行者路由WEB认证可以对接第三方PORTAL认证

神行者路由WEB认证需要授权认证才能正常使用

神行者路由WEB认证支持代拨

- PC端界面

![](http://static.toughcloud.net/toughsms/tc_20181224131528_9.png)

- 移动端界面

![](http://static.toughcloud.net/toughsms/tc_20181224131610_10.png)

#### WEB认证配置步骤

WEB认证和PPPOE拨号是共用服务的。开启web认证后，该服务同时也提供PPPOE拨号服务

WEB认证用户获取的IP地址实际上是DHCP下发的。

1. 建立LAN线路

“网络设置”--“内网设置” 新增lan线路

![](http://static.toughcloud.net/toughsms/tc_20181224131729_11.png)

2. 建立DHCP服务

“DHCP设置”--“DHCP服务” 选择刚建立的lan线路，新增DHCP服务

![](http://static.toughcloud.net/toughsms/tc_20181224131816_12.png)

3. 新建WEB服务

“认证设置”--“WEB服务”--“新建”

WEB认证和PPPOE服务共用同一个服务，开启WEB认证后，也可以用作PPPOE拨号服务

![](http://static.toughcloud.net/toughsms/tc_20181224131907_13.png)

- 服务名称：WEB服务的名称，和计费的NAS标识一致。
- 监听接口：WEB服务监听的物理网卡，这里需要选择前面建立lan线路的物理网卡
- 外层 VLAN：指定一个或者多个VLAN，默认勾选所有的VLAN。
- 内层 VLAN：QINQ 环境下指定一个或者多个内层 VLAN，默认勾选所有的VLAN。
- 默认网关：WEB认证服务的网关地址。
- 地址池：WEB认证服务如需要代拨时会用到。
- 最大接入用户数：指定WEB认证服务的最大接入用户数量，默认10000个。
- 过期用户在线时长：指定已经过期的WEB认证用户允许的每次最大在线时间，单位秒，默认 300 秒。
- 最大在线时长：WEB认证用户允许的每次最大在线时间，单位分钟，默认0，表示不限制在线时间。
- 认证方式-本地认证：使用本地用户管理来认证用户。
- 认证方式-RADIUS 认证：使用RADIUS对接的方式来认证用户。
- 认证方式-先本地再RADIUS认证：先使用本地用户管理来认证用户，本地认证失败的用户再使用RADIUS对接的方式来认证。
- 认证方式-免认证： 放行所有以账号密码方式认证的用户，并且不会有限速。

![](http://static.toughcloud.net/toughsms/tc_20181224132034_14.png)

- WEB认证：启用开关。
- HASH：可以选择IP、MAC、无感知。一般选择ip+mac的组合即可。
- 无流量认证：客户机离线后，指定的时间内无上行流量则踢线，0表示不开启流量探测机制。
- 认证类型：自定义方式，包括账号密码认证、微信认证、密码认证，可多选。
- 跳转地址：账号密码认证、密码认证成功后跳转到指定页面。
- SSID：微信公众号里WIFI设备填写的SSID名称。
- ShopID：微信认证需要填写的。
- Appid：微信认证需要填写的。
- SecretKey：微信认证需要填写的。
- 密码：密码认证方式填写的固定密码。

![](http://static.toughcloud.net/toughsms/tc_20181224132134_15.png)

- 认证类型：PORTAL认证，对接第三方PORTAL

![](http://static.toughcloud.net/toughsms/tc_20181224132203_16.png)

- 开启流量检测：开启关闭PPPOE客户机的流量信息发送到计费服务器，默认关闭
- 允许计费用户多拨：是否允许对接RADIUS的用户多拨，默认允许
- PPPOE代理拨号：是否开启允许指定地址池的PPPOE用户代理拨号

4. WEB认证界面配置

“认证设置”--“WEB配置”

![](http://static.toughcloud.net/toughsms/tc_20181224132305_17.png)

- 自动呼出PORTAL页面：关闭后，一些设备web页面第一次连接wifi无法自动弹出web认证页面，同时跳转web页面的方式是302；开启后，可以实现90%移动设备的自动弹出认证页面。
- 认证方式：认证页面展示的认证方式，可多选。

5. 配置接入神行者AP设备

开启AC控制，神行者AP设备接WAN口，成功后，会自动扫描到AP设备。

![](http://static.toughcloud.net/toughsms/tc_20181224132408_18.png)

6. 设备认证


设备连接到wifi后，会自动弹出WEB认证页面

也可以通过打开浏览器，输入或者选择网站来打开WEB认证页面

如果选择的是https网站，跳转WEB认证页面会弹出如下提示，点击 继续浏览 即可

![](http://static.toughcloud.net/toughsms/tc_20181224132441_19.png)

1) **微信认证步骤**

点击微信认证，点击微信连WIFI

![](http://static.toughcloud.net/toughsms/tc_20181224132539_20.png)

弹出警告，点击允许，自动跳转到微信

![](http://static.toughcloud.net/toughsms/tc_20181224132613_21.png)

点击关注，即可完成微信认证流程

![](http://static.toughcloud.net/toughsms/tc_20181224132647_22.png)

2) **账户密码方式**

账户管理或者计费建立用户后，即可使用该方法认证

![](http://static.toughcloud.net/toughsms/tc_20181224132752_23.png)

3) **密码认证方式**

WEB服务配置密码认证使用的密码，可以无限制多个用户使用密码方式认证

![](http://static.toughcloud.net/toughsms/tc_20181224132835_24.png)


#### **问题**

- 无法弹出认证界面或者弹出页面缓慢


```
    > 解决方案

    1) 检查连接的设备是否能上网

    a．如果可以上网

    - 检查设备IP是否从DHCP服务里获取的IP范围；
    - 认证设置-免拨主机里面的免认证MAC是否包括这个设备的MAC地址或者IP地址；
    - 认证设置-在线信息，是否已经认证成功了；

    b．如果不可以上网，可以先手工打开浏览器，输入正确的http的网址，弹出Portal认证页面，点击认证上网。


    2) 若上述方法无效，按照以下步骤进行排查。

    接出一根有线网连接在电脑上，打开网页，弹出portal 页面，但是无线的不能出或者出的比较缓慢，这种情况就需要检测下无线环境和无线设备方面的问题。

    （如果你是使用神行者AP，是可以直接在AC智能控制里，通过AP周边信道来检查下是否是信道干扰，优化信道、频宽、信号强度等设置信息实现减少无线干扰。）
```

 
- 认证限速问题，速度限制不住

```
    > 解决方案
    - 微信认证和密码认证只能通过QOS流控-高级流控配置限速
    - 用户密码认证，检查认证设置-账户管理的限速信息，如对接计费检查计费的限速信息是否填写正确
```

- 认证上网后，打开网页慢，视频卡顿

```
    出现这种问题，一般和认证无关
    > 解决方案
    - 检查该设备是否认证成功
    - 检查该设备的IP地址在路由里设置了限速
    - 有线是否正常。有线正常，无线异常，建议检查无线信号
```


- 之前认证成功过，现在又需要认证

```
    > 解决方案
    - 检查路由认证设置-在线信息，账号是否在线，是否有踢线
    - 检查路由认证设置-web服务，是否配置无流量认证时长
    - 检查路由认证设置-web服务是否开启关闭过
```
 

- 打开百度或者淘宝等HTTPS网址时，提示“证书”

```
    > 解决方案
    - HTTPS页面打开认证时，会出现证书提示，直接点击继续即可正常弹出Portal页面
    - 直接打开HTTP网址，也可以直接弹出Portal页面
```

- 手机无法弹出认证页面

```
    总结：如连接wifi后20秒内没有自动弹出认证页面，请手动点击浏览器，点击http页面辅助弹出认证页面
```

- 开启web认证，不出认证界面，不能上网

```
    排查思路：
    首先确定终端设备获取的IP、掩码、网关、DNS等信息是否正确；
    检查web服务是否正确配置；
    检测有线是否能弹出认证页面，如果有线能弹出、无线不能弹出，则检查AP信道强度，信道干扰等信息；
```

- WEB认证二级路由下能否使用

```
    解答：
    神行者路由的WEB认证是基于IP校验的，所以分两种情况
    如果是路由动作过来的，那么下面每台设备都需要认证
    如果是NAT动作过来的，经过了地址转换，则下面任意一台设备验证后，下面所以设备都可以上网了。
```

























