### 5.1 神行者宽带二次认证解决方案

本方案针对二级宽带运营商与一级运营商合作场景中出现的需要在多个数据中心实现用户认证的情况，提出总体解决方案，用来指导相关人员根据实际情况解决业务问题。

#### 标准网络结构

![](http://static.toughcloud.net/toughsms/tc_20181224100200_1.png)

在标准业务场景，所有业务用户只需要在本地数据中心的RADIUS服务器认证，不存在第三方认证的情况。 

#### 合作运营网络结构

![](http://static.toughcloud.net/toughsms/tc_20181224100617_2.png)

本地运营商与一级运营商开展业务合作，本地运营商接入网基础网络完善，覆盖业务用户群广泛，但出口带宽不足，无法快速发展更多用户，通过和一级运营商合作的模式，利用一级运营商提供的合作出口，快速发展用户，并与一级运营商实现盈利分成。


#### 业务需求分析

##### 二次认证需求

一级运营商要求提供用户资料，包括用户认证密码，实名信息，要求合作用户必须在一级运营商的认证系统实现认证计费。 

- 通常本地业务操作员在本地系统录好数据后，再次通过一级运营商提供的业务系统界面录入信息，该方法操作繁琐，效率低下。
- 如果一级运营商业务系统提供数据授权接口，技术上可以实现本地业务系统自动实现数据同步授权，用户数据只需录入一次即可。

##### 出口智能调度

本地运营商要求所有用户必须在本地认证系统保存，用户通过OLT接入后必须首先在本地认证系统进行认证。用户通过认证后，本地用户通过本地出口上网，合作用户通过合作出口上网。

- 本地运营商可以通过不同的接入端口，或VLAN来区分本地用户和合作用户，该方法操作繁琐，不够灵活。
- 本地运营商分配给用户带域的账号，用户带域拨号，BRAS可以识别域，然后区分不同用户，但该方法管理用户不灵活，用户可以随意修改域，对存量用户的修改需要逐个通知用户。
- 当区分不同用户类型后，本地用户走本地认证，合作用户通过BRAS的隧道认证模式走一级运营商的认证流程，在这种模式下，合作用户无法在本地认证，一次迫切需要解决二次认证的需求。 在用户走一级运营商隧道认证的模式下，用户的有效信息在本地运营商业务系统可能处于缺失或不准确状态。


#### 神行者技术方案

![](http://static.toughcloud.net/toughsms/tc_20181224100929_3.png)

采用神行者BRAS和神行者专版计费，可以完美的解决当前的二次认证需求。不论是本地用户还是合作用户，首次用户必定是在本地进行认证，认证系统自动识别用户类型，并反馈给BRAS，如果是本地用户，就通过本地认证流程认证并自动分配本地出口，如果是合作用户，BRAS将向一级运营商BRAS发起PPPOE代理拨号，分配合作出口，相比隧道验证，PPPOE代理拨号可能支持更大的用户数。

#### 二次认证流程

![](http://static.toughcloud.net/toughsms/tc_20181224101106_4.png)


#### 现有系统升级方案

除了通过神行者BRAS 和神行者专版计费组合方案外，同时也提供了对本地运营商已有计费的升级方案，神行者BRAS 提供了标准的RADIUS 协议支持以及符合规范的特定协议扩展，第三方RADIUS 计费系统按神行者BRAS 提供的协议进行功能扩展。 在用户通过认证时下发以下一个或多个授权属性就可以实现触发BRAS 代理拨号。

#### 合作用户留存方案

对于在本地运营商认证系统中未录入的用户数据，可以通过神行者BRAS  PPPOE 代理拨号的用户密码探测功能采集准确的用户信息并同步至本地认证系统，即使与合作运营商终止合作后，这部分用户仍可以留存在本地运营商。

#### 方案优势

神行者BRAS二次认证方案与其他知名品牌（华为、中兴、爱立信）提供方案的比较

![](http://static.toughcloud.net/toughsms/tc_20181224102421_5.png)
